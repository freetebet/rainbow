<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.rainbow.company.ProductManagement.mapper.productPageMapper">
	<!-- productList   -->
	<select id="prdList" resultType="org.rainbow.company.ProductManagement.domain.productListVO">
	
	        SELECT *
			    FROM RAIN_Suppliers_tbl s, RAIN_Products_tbl p
			    where  p.SUPSNO = s.SUPSNO
			    order by p.prdNo asc
		
	</select>
<!-- 	<select id="prdList" resultType="org.rainbow.company.ProductManagement.domain.productListVO" parameterType="org.rainbow.domain.Criteria">
		<![CDATA[
	        SELECT *
			FROM (
			    SELECT rownum rn, p.PRDNO, p.SUPSNO, s.SUPSCO, p.PRDSDC, p.PRDTAXEXST, p.PRDMAJORCTG, p.PRDSUBCTG, p.PRDNAME, p.PRDCSTPRI, p.PRDCSTSUP, p.PRDCSTTAX, p.PRDSAL,
			           p.PRDSALSUP, p.PRDSALTAX, p.PRDMARGIN, p.PRDST, p.PRDIMG
			    FROM
			    (
			        SELECT PRDNO, SUPSNO, PRDSDC, PRDTAXEXST, PRDMAJORCTG, PRDSUBCTG, PRDNAME, PRDCSTPRI, PRDCSTSUP, PRDCSTTAX, PRDSAL,
			               PRDSALSUP, PRDSALTAX, PRDMARGIN, PRDST, PRDIMG
			        FROM RAIN_Products_tbl
			        ORDER BY PRDNO ASC
			     ) p
			    JOIN RAIN_Suppliers_tbl s ON p.SUPSNO = s.SUPSNO
			    WHERE rownum <= #{pageNum} *  #{amount}
			)
			WHERE rn > (#{pageNum} - 1) *  #{amount} 
		 ]]>
	</select> -->
	
	<!-- productList 카운트 셀렉트 페이징 처리시 사용 -->
	<select id="prdCount" resultType="int">
	SELECT COUNT(*) FROM RAIN_Products_tbl
	</select>
	
	<select id="getSearch" parameterType="org.rainbow.domain.Criteria" resultType="org.rainbow.company.ProductManagement.domain.productListVO">
		
	        SELECT *
			FROM RAIN_Products_tbl
		    JOIN RAIN_Suppliers_tbl s ON p.SUPSNO = s.SUPSNO
		    WHERE prdNo = #{keyword} OR prdMajorCtg = #{keyword} OR prdSubCtg LIKE '%' || #{keyword} || '%' OR prdName LIKE '%' || #{keyword} || '%'
		    ORDER BY PRDNO ASC
		
	</select>
	
	
	<!-- 검색된 리스트 카운트    검색  like 좀더 써야할거같음.. 추후수정 -->
	<select id="getKeywordCount" parameterType="org.rainbow.domain.Criteria" resultType="int">
	    SELECT count(*) 
	    FROM RAIN_Products_tbl 
	    WHERE 
	        prdNo = #{keyword} OR prdMajorCtg = #{keyword} OR prdSubCtg = #{keyword} OR prdName LIKE '%'|| #{keyword} || '%'
	</select>
	
	<!-- 엑셀 파일 리스트로 받아서 인서트  -->
	<insert id= "insertPrdExcel" parameterType="org.rainbow.company.ProductManagement.domain.prdInputVO">
		insert into RAIN_Products_tbl values
		(
			#{prdNo}, #{supsNo}, #{prdSdc} ,#{prdTaxExSt},
			#{prdMajorCtg} ,#{prdSubCtg} ,#{prdName} ,#{prdCstPri},	
			#{prdCstSup}, #{prdCstTax}, #{prdSal}, #{prdSalSup} ,#{prdSalTax}, 
			#{prdMargin}, #{prdSt}, #{prdImg}
		)
	</insert>
	<!-- 동적으로  체크 박스 벨류 받아서 리스트 구해오기-->
	<select id="downExcelList" resultType="org.rainbow.company.ProductManagement.domain.prdDownVO">
	        SELECT s.supsCo, p.prdNo, p.prdSdc, p.prdMajorCtg, p.prdSubCtg, p.prdName, p.prdCstPri, p.prdSal, p.prdMargin, p.prdImg
		    FROM RAIN_Products_tbl p, RAIN_Suppliers_tbl s
		    WHERE s.supsNo = p.supsNo
		    AND p.prdMajorCtg IN
	    <foreach item="item" collection="checkValues" open="(" separator="," close=")">
	        #{item}
	    </foreach>
	    AND p.prdSt IN
	    <foreach item="item" collection="checkValues" open="(" separator="," close=")">
	        #{item}
	    </foreach>
	</select>
	<!--  
		foreach 마이바티스 반복
		item 변수 이름
		collection="ex)checkValues" 반복할 리스트 지정
		open="(" separator="," close=")" 시작 , 구분자 , 끝 부분 지정
		지금 쿼리 같은경우 
		<foreach item="item" collection="checkValues"> 이런식으로
		기본값을 넣어도 동작하는데 문제없는것 같다.
		
		SELECT s.supsCo, p.prdNo, p.prdSdc, p.prdMajorCtg, p.prdSubCtg, p.prdName, p.prdCstPri, p.prdSal, p.prdMargin, p.prdImg
		FROM RAIN_Products_tbl p, RAIN_Suppliers_tbl s
		WHERE s.supsNo = p.supsNo
		AND p.prdMajorCtg IN ('value1', 'value2', 'value3')
		AND p.prdSt IN ('value1', 'value2', 'value3') 기존코드 
	-->

	
	
</mapper>
